deviance <- pois_model$deviance
df <- pois_model$df.residual
p_value <- 1 - pchisq(deviance, df)
p_value                # >1 indicates overdispersion
dispersion_ratio <- pois_model$deviance / pois_model$df.residual
dispersion_ratio
library(plyr)
library(MASS)
nb_model <- glm.nb(cases ~ 1, data = malaria)
summary(nb_model)
AIC(pois_model, nb_model)
exp(coef(nb_model))
set.seed(2026)
n <- 1000
age <- round(runif(n, 18, 80))
smoking <- rbinom(n, 1, 0.3)
ses <- factor(sample(c("Low","Medium","High"), n, replace=TRUE))
linpred <--4 + 0.04*age + 0.9*smoking
prob <- 1 / (1 + exp(-linpred))
disease <- rbinom(n, 1, prob)
epi_data <- data.frame(age, smoking, ses, disease)
set.seed(2026)
n <- 1000
age <- round(runif(n, 18, 80))
smoking <- rbinom(n, 1, 0.3)
ses <- factor(sample(c("Low","Medium","High"), n, replace=TRUE))
linpred <--4 + 0.04*age + 0.9*smoking
prob <- 1 / (1 + exp(-linpred))
disease <- rbinom(n, 1, prob)
epi_data <- data.frame(age, smoking, ses, disease)
# Crude model: disease vs smoking only
crude_model <- glm(disease ~ smoking, family = binomial(link = "logit"), data = epi_data)
summary(crude_model)
# Adjusted model: disease vs smoking + age + SES
adjusted_model <- glm(disease ~ smoking + age + ses, family = binomial(link = "logit"), data = epi_data)
summary(adjusted_model)
# Crude ORs
exp(cbind(OR = coef(crude_model), confint(crude_model)))
# Adjusted ORs
exp(cbind(OR = coef(adjusted_model), confint(adjusted_model)))
# Crude OR for smoking
model_smoking <- glm(disease ~ smoking, data = epi_data, family = binomial)
OR_crude <- exp(coef(model_smoking)["smoking"])
# Adjusted OR for smoking (adjusting for age and SES)
model_adj <- glm(disease ~ smoking + age + ses, data = epi_data, family = binomial)
OR_adj <- exp(coef(model_adj)["smoking"])
OR_crude
OR_adj
# Add interaction term
model_inter <- glm(disease ~ smoking * ses + age, data = epi_data, family = binomial)
summary(model_inter)
# p-values
summary(model_inter)$coefficients
library(pROC)
# Predict probabilities from adjusted model
pred_prob <- predict(adjusted_model, type = "response")
# ROC curve
roc_curve <- roc(epi_data$disease, pred_prob)
plot(roc_curve, main="ROC Curve")
auc(roc_curve)  # Area Under the Curve
set.seed(2026)
n <- 1200
age <- round(runif(n, 18, 80))
bmi <- rnorm(n, mean = 25 + 0.05*(age-40), sd = 4)
sbp <- rnorm(n, mean = 110 + 0.6*(age-40) + 0.8*(bmi-25), sd =
15)
glucose <- rlnorm(n, meanlog = log(90 + 0.3*(age-40)), sdlog =
0.25)
adult_health <- data.frame(age, bmi, sbp, glucose)
adult_health
library(moments)
desc_stats <- function(x) {
c(
mean = mean(x),
median = median(x),
trimmed_mean = mean(x, trim = 0.1),
sd = sd(x),
IQR = IQR(x),
skewness = skewness(x),
kurtosis = kurtosis(x)
)
}
stats_age <- desc_stats(adult_health$age)
stats_bmi <- desc_stats(adult_health$bmi)
stats_sbp <- desc_stats(adult_health$sbp)
stats_glucose <- desc_stats(adult_health$glucose)
stats_age
stats_bmi
stats_sbp
stats_glucose
identify_outliers <- function(x) {
Q1 <- quantile(x, 0.25)
Q3 <- quantile(x, 0.75)
IQR_value <- IQR(x)
lower_bound <- Q1 - 1.5 * IQR_value
upper_bound <- Q3 + 1.5 * IQR_value
x[x < lower_bound | x > upper_bound]
}
outliers <- lapply(adult_health, identify_outliers)
outliers
outliers_iqr <- function(x) {
Q1 <- quantile(x, 0.25)
Q3 <- quantile(x, 0.75)
IQR_val <- Q3 - Q1
lower <- Q1 - 1.5 * IQR_val
upper <- Q3 + 1.5 * IQR_val
x[x < lower | x > upper]
}
out_age <- outliers_iqr(adult_health$age)
out_bmi <- outliers_iqr(adult_health$bmi)
out_sbp <- outliers_iqr(adult_health$sbp)
out_glucose <- outliers_iqr(adult_health$glucose)
cat("here is the number of outliers in each variable respectively")
length(out_age)
length(out_bmi)
length(out_sbp)
length(out_glucose)
lm(list=ls())
rm(list = ls())
install.packages("VGAMdata")
install.packages("VGAMdata")
install.packages("VGAMdata")
library(VGAMdata)
library(VGAMdata)
install.packages("VGAMdata")
library(VGAMdata)
data("belcap")
data("belcap")
View(belcap)
# Create caries variable at baseline
belcap$caries_b <- ifelse(belcap$dmftb > 0, 1, 0)
n_total <- nrow(belcap)
n_cases <- sum(belcap$caries_b)
prev <- n_cases / n_total
prev
n_total <- nrow(belcap)
n_cases <- sum(belcap$caries_b)
prev <- n_cases / n_total
prev
se <- sqrt(prev * (1 - prev) / n_total)
lower <- prev - 2 * se
upper <- prev + 2 * se
c(lower, upper)
table_gender <- table(belcap$gender, belcap$caries_b)
prop.table(table_gender, 1)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n
)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
belcap %>%
group_by(gender) %>%
summarise(
prevalence = mean(caries_b),
lower = prevalence - 2 * sqrt(prevalence*(1-prevalence)/n()),
upper = prevalence + 2 * sqrt(prevalence*(1-prevalence)/n())
)
belcap %>%
group_by(gender) %>%
summarise(
prevalence = mean(caries_b),
lower = prevalence - 1.96 * sqrt(prevalence*(1-prevalence)/n()),
upper = prevalence + 1.96 * sqrt(prevalence*(1-prevalence)/n())
)
# Calculate prevalence and 95% CI stratified by gender
belcap %>%
group_by(gender) %>%
summarise(
prevalence = mean(caries_b),
lower_95CI = prevalence - 1.96 * sqrt(prevalence*(1-prevalence)/n()),
upper_95CI = prevalence + 1.96 * sqrt(prevalence*(1-prevalence)/n())
)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n()),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
data("belcap")
View(belcap)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n
)
# Create caries variable at baseline
belcap$caries_b <- ifelse(belcap$dmftb > 0, 1, 0)
n_total <- nrow(belcap)
n_cases <- sum(belcap$caries_b)
prev <- n_cases / n_total
prev
se <- sqrt(prev * (1 - prev) / n_total)
lower <- prev - 2 * se
upper <- prev + 2 * se
c(lower, upper)
table_gender <- table(belcap$gender, belcap$caries_b)
prop.table(table_gender, 1)
table_gender <- table(belcap$gender, belcap$caries_b)
prop.table(table_gender, 1)
# Create caries variable at baseline
belcap$caries_b <- ifelse(belcap$dmftb > 0, 1, 0)
n_total <- nrow(belcap)
n_cases <- sum(belcap$caries_b)
prev <- n_cases / n_total
prev
se <- sqrt(prev * (1 - prev) / n_total)
lower <- prev - 2 * se
upper <- prev + 2 * se
c(lower, upper)
table_gender <- table(belcap$gender, belcap$caries_b)
prop.table(table_gender, 1)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n
)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 1.96*se,
upper = prevalence + 1.96*se
)
# Calculate prevalence and 95% CI stratified by gender
belcap %>%
group_by(gender) %>%
summarise(
prevalence = mean(caries_b),
lower_95CI = prevalence - 1.96 * sqrt(prevalence*(1-prevalence)/n()),
upper_95CI = prevalence + 1.96 * sqrt(prevalence*(1-prevalence)/n())
)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 1.96*se,
upper = prevalence + 1.96*se
)
library(dplyr)
belcap %>%
group_by(school) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 1.96*se,
upper = prevalence + 1.96*se
)
belcap %>%
group_by(school, gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 1.96*se,
upper = prevalence + 1.96*se
)
# Create incident case variable
belcap <- belcap %>%
mutate(
at_risk = ifelse(dmftb == 0, 1, 0),
incident = ifelse(dmftb == 0 & dmfte > 0, 1, 0)
)
# Keep only children at risk
risk_set <- belcap %>% filter(at_risk == 1)
# Calculate incidence and 95% CI
risk_set %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 1.96 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 1.96 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(gender) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 1.96 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 1.96 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(school) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 1.96 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 1.96 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(school, gender) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 1.96 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 1.96 * sqrt(incidence*(1-incidence)/n())
)
data("belcap")
View(belcap)
# Create caries variable at baseline
belcap$caries_b <- ifelse(belcap$dmftb > 0, 1, 0)
n_total <- nrow(belcap)
n_cases <- sum(belcap$caries_b)
prev <- n_cases / n_total
prev
se <- sqrt(prev * (1 - prev) / n_total)
lower <- prev - 2 * se
upper <- prev + 2 * se
c(lower, upper)
library(dplyr)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 1.96*se,
upper = prevalence + 1.96*se
)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
belcap %>%
group_by(school) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 1.96*se,
upper = prevalence + 1.96*se
)
belcap %>%
group_by(school) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
belcap %>%
group_by(school, gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
# Create incident case variable
belcap <- belcap %>%
mutate(
at_risk = ifelse(dmftb == 0, 1, 0),
incident = ifelse(dmftb == 0 & dmfte > 0, 1, 0)
)
# Keep only children at risk
risk_set <- belcap %>% filter(at_risk == 1)
# Calculate incidence and 95% CI
risk_set %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 2 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 2 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(gender) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 2 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 2 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(school) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 1.96 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 1.96 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(school) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 2 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 2 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(school, gender) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 1.96 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 1.96 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(school, gender) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 2 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 2 * sqrt(incidence*(1-incidence)/n())
)
risk_set %>%
group_by(gender, school ) %>%
summarise(
incidence = mean(incident),
lower_95CI = incidence - 2 * sqrt(incidence*(1-incidence)/n()),
upper_95CI = incidence + 2 * sqrt(incidence*(1-incidence)/n())
)
belcap %>%
group_by(gender, school) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
data("belcap")
View(belcap)
data("belcap")
data("belcap")
View(belcap)
library(VGAMdata)
library(VGAMdata)
data("belcap")
View(belcap)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
library(VGAMdata)
data("belcap")
View(belcap)
belcap$caries_b <- ifelse(belcap$dmftb > 0, 1, 0)
n_total <- nrow(belcap)
n_cases <- sum(belcap$caries_b)
prev <- n_cases / n_total
prev
se <- sqrt(prev * (1 - prev) / n_total)
lower <- prev - 2 * se
upper <- prev + 2 * se
c(lower, upper)
library(dplyr)
belcap %>%
group_by(gender) %>%
summarise(
n = n(),
cases = sum(caries_b),
prevalence = cases/n,
se = sqrt(prevalence*(1-prevalence)/n),
lower = prevalence - 2*se,
upper = prevalence + 2*se
)
pwd
setwd("C:/Users/gihoz/OneDrive/Desktop/biostatistics-epidemiology-R")
